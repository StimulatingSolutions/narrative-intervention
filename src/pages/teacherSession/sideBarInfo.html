<ion-content class="side-bar-info-content" [class.response-mode]="session?.readyForResponse" [class.open-response]="session?.openResponse">
  <ion-card>
    <ion-card-header>
      <ion-buttons class='button-container find-place'>
        <button ion-button color="secondary" (click)="findMyPlace()">Find My Place</button>
      </ion-buttons>
      <ion-buttons class='button-container exit'>
        <button ion-button color='danger' (click)="exitCurrentSession()">Exit</button>
      </ion-buttons>
    </ion-card-header>
    <ion-card-content>
      <div class="student-list">
        <div class="student" *ngFor="let user of session?.activeUsers">

          <div [class.waitingforanswer]="session?.readyForResponse" [class.answered]="idsWithAnswer.indexOf(user) > -1" [class.incorrect]="session?.correctAnswer && session?.correctAnswer != currentResponses[user]?.response">
            <div class='answered-icon' *ngIf="session?.readyForResponse && idsWithAnswer.indexOf(user) === -1">
              <ion-icon name="radio-button-off"></ion-icon>
            </div>
            <div class='answered-icon' *ngIf="session?.readyForResponse && idsWithAnswer.indexOf(user) > -1 && (!session?.correctAnswer || session?.correctAnswer === currentResponses[user]?.response)">
              <ion-icon name="checkmark-circle"></ion-icon>
            </div>
            <div class='answered-icon' *ngIf="session?.readyForResponse && idsWithAnswer.indexOf(user) > -1 && session?.correctAnswer && session?.correctAnswer !== currentResponses[user]?.response">
              <ion-icon name="close-circle"></ion-icon>
            </div>
            <span [class.bold]="session?.readyForResponse && (idsWithAnswer.indexOf(user) === -1 || (session?.correctAnswer && session?.correctAnswer !== currentResponses[user]?.response))">
              {{user}}
            </span>
            <div class='student-response' *ngIf="session?.readyForResponse && idsWithAnswer.indexOf(user) > -1">
              {{['difficulty','appeal','efficacy'].indexOf(session.questionType) != -1 ? session.questionType+': ' : ''}}{{currentResponses[user].response}}
            </div>
          </div>
        </div>
        <div *ngIf="session?.activeUsers.length === 0 && session?.active">
          <i>No students have connected to this session yet.</i>
        </div>
        <div *ngIf="!session?.active">
          <i>This session has been marked as finished by the head teacher.</i>
        </div>
      </div>
      <div class="student-count">
        <div *ngIf="!session?.readyForResponse">
          There are <b>{{session?.activeUsers.length || 0}}</b> students in this session.
        </div>
        <div *ngIf="session?.readyForResponse && !session?.openResponse">
          <p>
            <b>{{waitCount}}</b> students have not responded yet.
          </p>
          <p *ngIf="session?.correctAnswer">
            <b>{{incorrectCount}}</b> students have an incorrect answer selected.
          </p>
          <p *ngIf="session?.correctAnswer">
            The correct answer is: <b>{{session?.correctAnswer}}</b>.
          </p>
          <div class="final-instructions" *ngIf="headTeacher">
            <p class="done-instructions">
              When you are ready to continue to the next step, tap the blue DONE button.
            </p>
          </div>
        </div>
        <div *ngIf="session?.readyForResponse && session?.openResponse">
          <p>
            This is an <b>Open Response</b> section.
          </p>
          <p>
            <span *ngIf="headTeacher">You</span><span *ngIf="!headTeacher">The head teacher</span> can continue to complete steps, and students can freely respond.
          </p>
          <div class="final-instructions" *ngIf="headTeacher">
            <p class="clear-instructions">
              To clear students' current responses, tap the orange CLEAR button.
            </p>
            <p class="done-instructions open-response">
              When you have finished the Open Response section, tap the blue DONE button.
            </p>
          </div>
        </div>
        <div class="response-actions">
          <ion-buttons class="button-container clear" *ngIf="headTeacher && session?.readyForResponse && session?.openResponse">
            <button ion-button color="warning" (click)="closeQuestion()">Clear</button>
          </ion-buttons>
          <ion-buttons class="button-container done" *ngIf="headTeacher && session?.readyForResponse">
            <button ion-button (click)="closeQuestion()">Done</button>
          </ion-buttons>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>
